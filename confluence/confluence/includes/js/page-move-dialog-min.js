define("confluence/page-move-dialog","ajs confluence/templates confluence/legacy window jquery confluence/breadcrumbs wrm".split(" "),function(b,f,l,A,a,v,B){return function(){function t(){a("#move-page-dialog").find(".button-spinner").each(function(b,m){a(m).spin()})}function s(){a("#move-page-dialog").find(".button-spinner").each(function(b,m){a(m).spinStop()})}function C(d,m,c,k,i,h,f){function o(a){f(a);l.enable();g.enable();e.enable();p.enable();r.enable();s()}a("#move-errors").remove();t();
var l=a("#move-page-dialog .move-button").disable(),g,p,r,e;if(a("#createpageform").length>0){if(!u){g=a("button.reorder-button").disable();p=a("#move-page-dialog .button-panel-cancel-link").disable();r=a("#move-page-dialog .dialog-back-link").disable();e=a("#move-page-dialog #reorderCheck").disable()}}else{g=a("button.reorder-button").disable();p=a("#move-page-dialog .button-panel-cancel-link").disable();r=a("#move-page-dialog .dialog-back-link").disable();e=a("#move-page-dialog #reorderCheck").disable()}b.safe.ajax({url:b.contextPath()+
"/pages/movepage.action",type:"GET",dataType:"json",timeout:18E4,data:new y(m,k,i,h),error:function(){o(b.I18n.getText("move.page.dialog.move.failed"))},success:function(a){var d=[].concat(a.validationErrors||[]).concat(a.actionErrors||[]).concat(a.errorMessage||[]);d.length>0?o(d):A.location.href=b.contextPath()+a.page.url+(a.page.url.indexOf("?")>=0?"&":"?")+"moved=true"}})}var u=b.DarkFeatures.isEnabled("editor.ajax.save")&&!b.DarkFeatures.isEnabled("editor.ajax.save.disable"),n=function(d){function m(d){var c=
a("#move-errors");c.length>0&&c.remove();var c=a(f.MovePage.errorMessage()),j=e.find(".browse-controls:visible");if(j.length)j.append(c);else{j=e.find(".dialog-panel-body:visible");j.prepend(c)}if(!d||d.length===0)a(r).prop("disabled",false);else{j=b.I18n.getText("errors.occurred");j=j+"<ul>\n<li>";j=a.isArray(d)?j+d.join("</li>\n<li>"):j+d;d=aui.message.warning({content:j+"</li>\n</ul>"});c.html(d);c.removeClass("hidden")}}var c=b.Meta.get("page-title"),d=a.extend({spaceKey:b.Meta.get("space-key"),
spaceName:b.Meta.get("space-name"),pageTitle:c,parentPageTitle:b.Meta.get("parent-page-title"),title:b.I18n.getText("move.page.dialog.title.view",c),buttonName:b.I18n.getText("move.name"),openedPanel:b.I18n.getText("move.page.dialog.panel.location"),moveHandler:function(a){b.debug("No move handler defined. Closing dialog.");a.remove()},cancelHandler:function(a){a.remove();return false}},d),k=d.spaceKey,i=d.spaceName,h=d.parentPageTitle,x="",o="",D=function(a,b){x=a;o=b},c=b.ConfluenceDialog({width:840,
height:590,id:"move-page-dialog"}),g={spaceKey:k,spaceName:i,parentPageTitle:h,canMoveBetweenSpaces:b.Meta.get("page-id")==0||b.Meta.getBoolean("can-remove-page")};c.addHeader(d.title);c.addPanel(b.I18n.getText("move.page.dialog.panel.location"),f.MovePage.movePageAdvancedPanel(g),"location-panel","location-panel-id");c.addPanel(b.I18n.getText("move.page.dialog.search.title"),f.MovePage.movePageSearchPanel(g),"search-panel","search-panel-id");c.addPanel(b.I18n.getText("move.page.dialog.history.title"),
f.MovePage.historyPanel({pageTitle:b.Meta.get("page-title")}),"history-panel","history-panel-id");c.addPanel(b.I18n.getText("move.page.dialog.browse.title"),f.MovePage.browsePanel({pageTitle:b.Meta.get("page-title")}),"browse-panel","browse-panel-id");c.get('#"'+b.I18n.getText("move.page.dialog.panel.location")+'"')[0].onselect=function(){a("#new-space-key").val(k);a("#new-space").val(i);a("#new-parent-page").val(h).select()};c.get('#"'+b.I18n.getText("move.page.dialog.search.title")+'"')[0].onselect=
function(){a("#move-page-dialog .search-panel .search-results .selected").removeClass("selected");a("#move-page-dialog input.search-query").focus()};c.get('#"'+b.I18n.getText("move.page.dialog.history.title")+'"')[0].onselect=function(){a(".history-panel",e).movePageHistory(q)};c.get('#"'+b.I18n.getText("move.page.dialog.browse.title")+'"')[0].onselect=function(){b.debug("browse: "+[k,i,h].join());a(".browse-panel",e).movePageBrowse(q,k,i,h,t,d.pageTitle)};var p=function(c){var g=a("#new-space:visible").val(),
j=a("#new-space-key").val(),e=a("#new-parent-page:visible").val();if(g&&(g!=i||j!=k||e!=h))l.Dialogs.Breadcrumbs.defaultGetBreadcrumbs({spaceKey:j,pageTitle:e},function(){l.PageLocation.set({spaceKey:j,spaceName:g,parentPageTitle:e});d.moveHandler(c,j,g,e,x,o,m)},function(d){a("#new-parent-breadcrumbs").html(f.MovePage.breadcrumbError());d.status===404&&q.error(b.I18n.getText("move.page.dialog.location.not.found"))});else{l.PageLocation.set({spaceKey:k,spaceName:i,parentPageTitle:h});d.moveHandler(c,
k,i,h,x,o,m)}};c.addButton(d.buttonName,function(c){if(a("#createpageform").length>0&&b.DarkFeatures.isEnabled("editor.ajax.save")&&!b.DarkFeatures.isEnabled("editor.ajax.save.disable"))p(c);else if(a("#reorderCheck")[0].checked){c.nextPage();c=a("#move-page-dialog");a(".ordering-panel",c).movePageOrdering(k,h,d.pageTitle,D)}else p(c)},"move-button aui-button aui-button-primary");a(".button-panel-button.move-button").attr("id","move-button");c.addCancel(b.I18n.getText("cancel.name"),d.cancelHandler);
c.popup.element.find(".dialog-title").prepend(f.MovePage.helpLink());a("#createpageform").length>0?u||c.addPage().addHeader(d.title).addPanel(b.I18n.getText("move.page.dialog.ordering.title"),f.MovePage.orderingPagePanel(),"ordering-panel","ordering-panel-id").addLink(b.I18n.getText("move.page.dialog.back.button"),function(a){a.prevPage()},"dialog-back-link").addButton(b.I18n.getText("move.page.dialog.order.button"),p,"reorder-button").addCancel(b.I18n.getText("cancel.name"),d.cancelHandler):c.addPage().addHeader(d.title).addPanel(b.I18n.getText("move.page.dialog.ordering.title"),
f.MovePage.orderingPagePanel(),"ordering-panel","ordering-panel-id").addLink(b.I18n.getText("move.page.dialog.back.button"),function(a){a.prevPage()},"dialog-back-link").addButton(b.I18n.getText("move.page.dialog.order.button"),p,"reorder-button").addCancel(b.I18n.getText("cancel.name"),d.cancelHandler);var r=c.get("button#"+d.buttonName)[0].item;if(a("#createpageform").length>0&&u)a("button.move-button").before(f.MovePage.spinnerButton());else{a("button.move-button").before(f.MovePage.reorderCheckbox());
a("button.reorder-button").before(f.MovePage.spinnerButton());a("#reorderRequirement").before(f.MovePage.spinnerButton())}c.gotoPage(0);var e=a("#move-page-dialog"),w=e.find(".dialog-page-menu"),g=e.find(".dialog-page-body"),s=a(w[0]),n=a(g[0]);n.height(s.height());n.width("75%");n.find(".dialog-panel-body").height(s.height()-71);w=a(w[1]);g=a(g[1]);w.width("0");g.width("100%");c.show();a(".location-panel .location-info",e).appendTo(a(".dialog-page-body:first",e));var v=new l.Dialogs.Breadcrumbs.Controller(a("#new-parent-breadcrumbs")),
q={moveButton:r,clearErrors:function(){m([])},error:m,select:function(c,d,g,e){b.debug("select: "+[c,d,g].join());a("#createpageform").length>0&&u&&typeof e!=="undefined"&&a("#parentPageId").val(e);k=c;i=d;h=g||"";a(r).prop("disabled",true);v.update({spaceKey:k,title:h},q)}};c.overrideLastTab();c.get('#"'+d.openedPanel+'"').select();var t=b.Meta.get("parent-page-title")||b.Meta.get("from-page-title");(new l.Dialogs.Breadcrumbs.Controller(a("#current-parent-breadcrumbs"))).update({spaceKey:b.Meta.get("space-key"),
title:h||t},q);a(".location-panel",e).movePageLocation(q);a(".search-panel",e).movePageSearch(q);a(".history-panel",e).movePageHistory(q);a("#new-parent-page").select();d.hint&&c.addHelpText(d.hint.template||d.hint.text,d.hint.arguments);B.require("wr!com.atlassian.confluence.plugins.confluence-page-restrictions-dialog:dialog-resources");return e},y=function(a,f,c,k){a={pageId:b.Meta.get("content-id")||b.Meta.get("page-id"),spaceKey:a};if(c){a.position=k;a.targetId=c}else if(f!=""){a.targetTitle=
f;a.position="append"}else a.position="topLevel";return a};b.bind("deferred.page-move.tools-menu",function(b){b.preventDefault();a("#move-page-dialog").length>0&&a("#move-page-dialog, body > .shadow, body > .aui-blanket").remove();new n({moveHandler:C});return false});var z;b.bind("deferred.page-move.editor",function(d){d.preventDefault();a("#move-page-dialog").length>0&&a("#move-page-dialog, body > .shadow, body > .aui-blanket").remove();new n({spaceName:z,spaceKey:a("#newSpaceKey").val(),pageTitle:a("#content-title").val(),
parentPageTitle:a("#parentPageString").val(),buttonName:b.I18n.getText("move.name"),title:b.I18n.getText("move.page.dialog.title.edit"),moveHandler:function(d,c,f,i,h,l,o){function n(){z=f;a("#newSpaceKey").val(c);a("#parentPageString").val(i);i!=""?a("#position").val("append"):a("#position").val("topLevel");if(a("#createpageform").length>0&&u){typeof a("#parentPageId")!=="undefined"&&typeof a("#parentPageId").val()!=="undefined"&&b.Meta.set("parent-page-id",a("#parentPageId").val());typeof c!=="undefined"&&
b.Meta.set("space-key",c)}if(h){a("#targetId").val(h);a("#position").val(l)}}if(b.Meta.get("shared-drafts")){t();b.safe.ajax({url:b.contextPath()+"/pages/movepage.action",type:"GET",dataType:"json",data:new y(c,i,h,l),error:function(){s();o(b.I18n.getText("move.page.dialog.move.failed"))},success:function(a){s();a=[].concat(a.validationErrors||[]).concat(a.actionErrors||[]).concat(a.errorMessage||[]);if(a.length>0)o(a);else{n();d.remove();v.update(c,i);b.trigger("editor-page-moved")}}})}else{n();
d.remove();v.update(c,i);b.trigger("editor-page-moved")}}});return false});return n}});require("confluence/module-exporter").safeRequire("confluence/page-move-dialog",function(b){var f=require("confluence/legacy");require("ajs").toInit(function(){var l=b();f.MovePageDialog=l})});