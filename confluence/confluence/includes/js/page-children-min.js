define("confluence/page-children",["jquery","ajs","raphael","confluence/api/constants"],function(e,d,k,f){return function(c){var g,h,e=function(a){if(a.homePage){var b=d.I18n.getText("home.page");return'<span class="child-display"><span class="icon icon-home-page" title="'+b+'">'+b+':</span> <a href="'+f.CONTEXT_PATH+a.href+'">'+a.text+"</a></span>"}return'<span class="child-display"><span class="'+(a.recentlyUpdated?"icon icon-recently-updated-page":"icon icon-page")+'" title="Page">Page:</span> <a href="'+
f.CONTEXT_PATH+a.href+'">'+d.escapeHtml(a.text)+"</a></span>"},l=function(a){var b=c("#page-children:not(.children-loaded)");j();if(a&&b.length)if(a.errorMessage)b.html("<span class='error'>"+a.errorMessage+"</span>");else{var d=[];c.each(a,function(a,b){d.push(e(b))});b.html(d.join(""));b.addClass("children-loaded")}},j=function(){h&&(h(),h=null);g.addClass("hidden")},i=function(a){d.safe.ajax({url:f.CONTEXT_PATH+"/json/pagechildrenstoresettings.action",type:"POST",data:{pageId:d.params.pageId,showChildren:a},
success:function(){},error:function(a,c){d.log("Failed to store the user 'showChildren' user setting: "+c)}})};c("#children-section a.children-show-hide").each(function(){c(this).click(function(a){var b=c("#children-section");if(b.hasClass("children-showing"))c("#page-children").hide(),i(!1),b.removeClass("children-showing").addClass("children-hidden");else{c("#page-children").show();if(c("#children-section:not(.children-showing)").length){var e=c("#page-children:not(.children-loaded)");e.length?
(g=c("<div class='throbber'></div>"),e.append(g),h=k.spinner(g[0],10,"#666"),d.safe.ajax({url:f.CONTEXT_PATH+"/json/pagechildren.action",type:"POST",data:{pageId:d.params.pageId,showChildren:!0},success:l,error:function(a,b){var c=d.I18n.getText("page.children.error.load");j();e.html("<span class='error'>"+c+"</span>");d.log("Error retrieving child pages: "+b)}})):i(!0)}else i(!0);b.removeClass("children-hidden").addClass("children-showing")}return d.stopEvent(a)})})}});
require("confluence/module-exporter").safeRequire("confluence/page-children",function(e){require("ajs").toInit(e)});