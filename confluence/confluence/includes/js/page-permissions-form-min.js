define("confluence/page-permissions-form",["jquery","ajs","document"],function(d,e,k){return function(g){var f={handleNonExistentEntityNames:function(a){a&&a.length&&(a=a.join(", "),this.showErrorMessage(e.I18n.getText("page.perms.error.invalid.entity.names")+" "+a))},showErrorMessage:function(a){e.messages.warning("#page-permissions-editor-form",{title:a,id:"page-permissions-error-div",insert:"prepend"});var a=d("#page-permissions-editor-form"),b=d("#page-permissions-tables"),c=423-a.outerHeight(!0)-
35;b.css("height",c);a.find(".icon-close").on("click",function(){b.height(286)})},isDuplicateEntityForType:function(a,b){return 0<d("#page-permissions-table ."+a.type+"-permission."+b+"-permission-row .permission-entity-name").filter(function(){return d(this).text()===a.name}).length},resetValidationErrors:function(){d("#page-permissions-tables").height(286);d("#page-permissions-error-div").remove()}},h,c=d("#page-permissions-names-input"),i=d("#page-permissions-names-hidden"),l=c.val();c.keypress(function(a){return 13===
a.keyCode?(j(),c.focus(),!1):!0});c.bind("selected.autocomplete-user-or-group",function(a,b){i.val(unescape(b.content.key.replace(/\+/g," ")));c.val("");j(b.content.type);a.preventDefault()});c.focus(function(){var a=c.next(".aui-dd-parent");if(a.length){a.show();var b=c.offset().left;a.offset().left!=b&&(a.css("margin-left",0),b-=a.offset().left,a.css("margin-left",b+"px"));b=c.offset().top+c.outerHeight();a.offset().top!=b&&(a.css("margin-top",0),b-=a.offset().top,a.css("margin-top",b+"px"));a.css({width:c.outerWidth()});
a.hide()}});h={getValue:function(){var a=i.val();a?i.val(""):(a=c.val(),a==l&&(a=""));return a},removeFromNameInput:function(a){if(a){var b=c.val();if(b){for(var b=b.split(","),e=0;e<b.length;e++)b[e]=d.trim(b[e]);b=d.grep(b,function(b){return""!=b&&b!=a});b.length?c.val(b.join(", ")):k.activeElement==c[0]&&c.val("")}}}};var j=function(a){f.resetValidationErrors();g.table.clearHighlight();var b=h.getValue();b&&g.addNames(b,a)};d("#page-permissions-choose-me").click(function(a){f.resetValidationErrors();
g.addNames(d(this).find(".remote-user-name").text());return e.stopEvent(a)});d("#permissions-error-div-close").click(function(a){f.resetValidationErrors();return e.stopEvent(a)});d("#add-typed-names").click(function(){j()});return{validator:f,nameField:h,setVisible:function(a){e.setVisible("#page-permissions-editor-form",a);e.setVisible(".remove-permission-link",a)},isShowing:function(){return!d("#page-permissions-editor-form").hasClass("hidden")},getPermissionType:function(){return d("#restrictViewRadio:checked").length?
"view":"edit"}}}});require("confluence/module-exporter").exportModuleAsGlobal("confluence/page-permissions-form","AJS.PagePermissions.Controls");