define("confluence/attachment-uploader",["ajs","jquery"],function(b,e){return function(f,h){var a,g,d,c;a=e.extend({getForm:function(){return e("form",f.baseElement)},getUploadingMessageElement:function(){return e(".upload-in-progress",f.baseElement)},pack:function(){},displayErrors:function(a){c.displayMessages(a);this.pack()},clearErrors:function(){c.clearMessages();this.pack()},setUploadInProgress:function(a,d){var c=this.getUploadingMessageElement();a&&c.html(d||this.getDefaultUploadingMessage());
b.setVisible(c,a);b.setVisible(this.getForm(),!a)},onUploadSuccess:function(){},getMessageHandler:function(){c||(c=b.MessageHandler({baseElement:e(".warning",f.baseElement)}));return c},getDefaultErrorMessage:function(){return b.I18n.getText("attachment.uploader.error")},getDefaultUploadingMessage:function(){return b.I18n.getText("attachment.uploader.uploading")},getContentId:function(){return b.Meta.get("attachment-source-content-id")}},h&&h(f));g=a.getMessageHandler();d=a.getForm();b.Meta.getBoolean("can-attach-files")?
(d.ajaxForm({dataType:"json",timeout:36E5,data:{contentId:a.getContentId(),responseFormat:"html"},resetForm:!0,beforeSubmit:function(){a.setUploadInProgress(!0);g.clearMessages()},success:function(b){a.setUploadInProgress(!1);if(!g.handleResponseErrors(b,a.getDefaultErrorMessage()))a.onUploadSuccess(b.attachmentsAdded||[])},error:function(c){a.setUploadInProgress(!1);g.displayMessages(a.getDefaultErrorMessage());b.logError("Response from server was: "+c.responseText)}}),d.find("input:file").change(function(){d.submit()})):
d.remove();return a}});require("confluence/module-exporter").exportModuleAsGlobal("confluence/attachment-uploader","Confluence.AttachmentUploader");