define("confluence/favourites",["jquery","ajs"],function(a,b){var h=[],k=function(c,f){c.attr("data-favourites-bound")||(c.delegate(".icon-add-fav, .icon-remove-fav","click",function(e){var g=a(e.target),e=c.attr("data-entity-type"),i=c.attr("data-entity-scope"),d;d=f&&f.getEntityId&&"function"==typeof f.getEntityId?f.getEntityId(g):c.attr("data-entity-id");if(h[d])b.log("Already busy toggling favourite for "+e+" '"+d+"'. Ignoring request.");else{if(i){var k=g.hasClass("icon-remove-fav")?"unfavourite":
"favourite",i=["confluence",i,e,k,"click"].join(".");b.trigger("analytics",{name:i,data:{id:d}})}h[d]=!0;var j=g.hasClass("icon-remove-fav"),n=g.parent().find(".icon-wait"),l,m;"page"==e?(l=b.contextPath()+"/json/"+(j?"removefavourite.action":"addfavourite.action"),m={entityId:d}):"space"==e?(l=b.contextPath()+"/json/"+(j?"removespacefromfavourites.action":"addspacetofavourites.action"),m={key:d}):console.error("Unsupported type: "+e);g.addClass("hidden");n.removeClass("hidden");b.safe.ajax({url:l,
type:"POST",data:m}).done(function(a){b.debug(a)}).fail(function(a,c){b.debug("Error Toggling Favourite: "+c)}).always(function(){n.addClass("hidden");g.parent().find(j?".icon-add-fav":".icon-remove-fav").removeClass("hidden");delete h[d];b.trigger(j?"remove-fav-complete":"add-fav-complete")});return!1}}),c.attr("data-favourites-bound",!0))};return{binder:function(){a(".entity-favourites").each(function(){a(this).attr("data-favourites-bound")||k(a(this),{})})},plugin:function(b){a(this).each(function(){var f=
a(this);k(f,b)})}}});require("confluence/module-exporter").safeRequire("confluence/favourites",function(a){var b=require("ajs"),h=require("jquery");b.Confluence.Binder.favourites=a.binder;h.fn.favourites=a.plugin});