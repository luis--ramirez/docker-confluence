define("confluence/input-driven-dropdown",["ajs","jquery","confluence/legacy","window","document"],function(f,e,n,h,o){function g(c,e){this._effect="appear";this._timer=null;this.id=c;this.options=e;this.busy=this.inactive=!1;this.cacheManager=f.Confluence.cacheManager()}var m=function(c,d){var b=c.options,a=c.dd;a&&(a.hide(),a.$.remove());b.ajsDropDownOptions=b.ajsDropDownOptions||{};b.ajsDropDownOptions&&!b.ajsDropDownOptions.alignment&&(b.ajsDropDownOptions.alignment="left");b.ajsDropDownOptions.selectionHandler=
b.ajsDropDownOptions.selectionHandler||function(a,b){if(a.type!="click"){var c=e("a",b).first(),d=c.attr("href");if(a.type==="keydown"&&(a.metaKey||a.ctrlKey)&&a.which===13)h.open(d,"_blank");else{c.click();o.location=d}a.preventDefault()}};a=c.dd=f.dropDown(d.matrix,b.ajsDropDownOptions)[0];b.ajsDropDownOptions&&b.ajsDropDownOptions.className&&a.$.addClass(b.ajsDropDownOptions.className);b.dropdownPlacement?b.dropdownPlacement(a.$):(f.log("No dropdownPlacement function specified. Appending dropdown to the body."),
e("body").append(a.$));var g=new n.Highlighter(d.queryTokens||[d.query]);e("li a:not(.dropdown-prevent-highlight) span",a.$).each(function(){var a=e(this);a.html(g.safeHighlight(a.text()))});var i=a.$.closest(".aui-dd-parent").width();i||(a.$.width("25em"),i=a.$.width());e("a span:not(.icon)",a.$).each(function(){var a=e(this),b=f("var","&#8230;"),c=b.width(),d=false;a.wrapInner(e("<em>"));e("em",a).each(function(){var a=e(this);a.show();if(this.offsetLeft+this.offsetWidth+c>i-20){for(var b=this.childNodes,
f=false,g=b.length-1;g>=0;g--){var h=b[g],k=1,l=h.nodeType===3?"nodeValue":"innerHTML",j=h[l];do if(k<=j.length)h[l]=j.substr(0,j.length-k++);else break;while(this.offsetLeft+this.offsetWidth+c>i-20);if(k<=j.length){f=true;break}}f?d=true:a.hide()}});if(d){a.append(b);this.elpss=b}});e("a span:not(.icon)",a.$).each(function(){var a=e(this),b;try{var c=a.data("properties");b=c?c.spaceName:null}catch(d){f.logError("Problem getting space name: "+d.message)}c=a.text();b&&(c=c+(" ("+f("i").html(b).text()+
")"));a.attr("title",c)});b.dropdownPostprocess&&b.dropdownPostprocess(a.$);a.show(c._effect);"function"===typeof b.onShow&&b.onShow.call(a,a.$);return a};g.prototype.clearCache=function(){this.cacheManager.clear()};g.prototype.change=function(c,d,b){var a=this;if(c!=a._value){a._value=c;a.busy=!1;h.clearTimeout(a._timer);var e=RegExp("\\S{"+(a.options.minLengthForGetData||2)+",}");if(d||e.test(c))if(d=a.cacheManager.get(c))m(a,d);else{a.busy=!0;var f=function(){a.options.getDataAndRunCallback.call(a,
c,function(){a.show.apply(this,arguments);b&&b(c)})};0===a.options.dropDownDelay?f():a._timer=h.setTimeout(function(){f()},a.options.dropDownDelay||200)}else a.dd&&a.dd.hide(),b&&b(c)}};g.prototype.hide=function(){this.dd&&this.dd.hide()};g.prototype.remove=function(){var c=this.dd;c&&(this.hide(),c.$.remove());this.inactive=!0;this.options.onDeath&&this.options.onDeath()};g.prototype.show=function(c,d,b){this.inactive?f.log("Quick search abandoned before server response received, ignoring. "+this):
(c={matrix:c,query:d,queryTokens:b},this.cacheManager.put(d,c),m(this,c),this.busy=!1)};return g});require("confluence/module-exporter").safeRequire("confluence/input-driven-dropdown",function(f){require("confluence/module-exporter").namespace("AJS.inputDrivenDropdown",function(e){return new f("inputdriven-dropdown",e)})});