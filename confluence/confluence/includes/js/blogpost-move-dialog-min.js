define("confluence/blogpost-move-dialog",["ajs","jquery","confluence/legacy","confluence/templates","confluence/api/constants"],function(b,a,h,j,k){function l(c,e,d){function f(b){d(b);g.enable();h.enable();a(".button-spinner").spinStop()}function i(a){b.trigger("analyticsEvent",{name:a,data:{newSpaceKey:e,oldSpaceKey:b.params.spaceKey,blogPostId:b.params.pageId}})}a("#move-blogpost-dialog .move-errors").empty();a(".button-spinner").spin();var g=a(".move-button").disable(),h=a("#move-blogpost-dialog .button-panel-cancel-link").disable();
""===e?f(b.I18n.getText("move.blogpost.dialog.no.space.selected")):a.ajax({url:k.CONTEXT_PATH+"/pages/moveblogpost.action",type:"GET",dataType:"json",timeout:18E4,data:{blogPostId:b.params.pageId,spaceKey:e},error:function(a){403===a.status||401===a.status?f(b.I18n.getText("not.permitted.description")):f(b.I18n.getText("move.blogpost.dialog.move.failed"));i("moveblogpost.ajaxError")},success:function(a){var c=[].concat(a.validationErrors||[]).concat(a.actionErrors||[]).concat(a.errorMessage||[]);
0<c.length?(f(c[0]),i("moveblogpost.serverValidationError")):(i("moveblogpost.success"),window.location.href=b.contextPath()+a.blogPost.url+(0<=a.blogPost.url.indexOf("?")?"&":"?")+"moved=true")}})}function g(c){function e(c){a("#move-blogpost-dialog .move-errors").empty();b.messages.error("#move-blogpost-dialog .move-errors",{body:c,closeable:!1})}b.Meta.get("page-title");var c=a.extend({spaceKey:b.Meta.get("space-key"),spaceName:b.Meta.get("space-name"),title:b.I18n.getText("move.blogpost.dialog.title"),
buttonName:b.I18n.getText("move.name"),moveHandler:function(a){b.debug("No move handler defined. Closing dialog.");a.remove()},cancelHandler:function(a){a.remove();return!1}},c),d=b.ConfluenceDialog({width:m,height:n,id:"move-blogpost-dialog"});d.addHeader(c.title);d.addPanel(b.I18n.getText("move.blogpost.dialog.panel.title"),j.MoveBlogPost.dialogPanel(),"move-blogpost-dialog-panel","move-blogpost-dialog-panel-id");a("#new-space").auiSelect2(h.UI.Components.SpacePicker.build());d.addButton(c.buttonName,
function(b){var d=a("#new-space").val();c.moveHandler(b,d,e)},"move-button");a(".button-panel-button.move-button").attr("id","move-button");d.addCancel(b.I18n.getText("cancel.name"),c.cancelHandler);d.popup.element.find(".dialog-button-panel").prepend("<div class='button-spinner'>&nbsp;</div>");d.show();return d}var m=400,n=250;return{control:g,initialiser:function(b){b.preventDefault();0<a("#move-blogpost-dialog").length&&a("#move-blogpost-dialog, body > .shadow, body > .aui-blanket").remove();new g({moveHandler:l});
return!1}}});require("confluence/module-exporter").safeRequire("confluence/blogpost-move-dialog",function(b){require("confluence/legacy").MoveBlogPostDialog=b.control;require("ajs").bind("deferred.blog-move.tools-menu.click",b.initialiser)});